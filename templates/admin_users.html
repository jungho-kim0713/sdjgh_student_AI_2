{% extends "index.html" %}

{% block content %}
<div class="admin-container">
    <h2>ğŸ‘¥ ì‚¬ìš©ì ê´€ë¦¬</h2>
    
    <div class="card">
        <h3>ì¼ê´„ ë“±ë¡ (ì´ë©”ì¼)</h3>
        <p>ì—¬ê¸°ì— ì´ë©”ì¼ì„ ì…ë ¥í•˜ë©´ í•´ë‹¹ êµ¬ê¸€ ê³„ì • ì‚¬ìš©ìëŠ” ì²« ë¡œê·¸ì¸ ì‹œ ìë™ ìŠ¹ì¸ë©ë‹ˆë‹¤.</p>
        <textarea id="emailList" rows="5" placeholder="user1@gmail.com&#10;user2@gmail.com" style="width:100%;"></textarea>
        <button onclick="batchAddUsers()" class="btn-primary" style="margin-top:10px;">ì¼ê´„ ë“±ë¡</button>
    </div>

    <div class="card" style="margin-top: 20px;">
        <h3>ì‚¬ìš©ì ëª©ë¡</h3>
        <table class="admin-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Username / Email</th>
                    <th>Role</th>
                    <th>ìŠ¹ì¸ ì—¬ë¶€</th>
                    <th>ê´€ë¦¬</th>
                </tr>
            </thead>
            <tbody>
                {% for user in users %}
                <tr>
                    <td>{{ user.id }}</td>
                    <td>
                        {{ user.username }}
                        {% if user.email and user.email != user.username %}
                        <br><span style="font-size:0.8em; color:#666;">({{ user.email }})</span>
                        {% endif %}
                    </td>
                    <td>{{ user.role }}</td>
                    <td>
                        {% if user.is_approved %}
                            <span class="badge success">ìŠ¹ì¸ë¨</span>
                        {% else %}
                            <span class="badge warning">ëŒ€ê¸°ì¤‘</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if not user.is_approved %}
                        <button onclick="approveUser({{ user.id }})" class="btn-small">ìŠ¹ì¸</button>
                        {% endif %}
                        <button onclick="deleteUser({{ user.id }})" class="btn-small danger">ì‚­ì œ</button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
async function approveUser(userId) {
    if (!confirm('ì´ ì‚¬ìš©ìë¥¼ ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
    const res = await fetch(`/admin/users/approve/${userId}`, { method: 'POST' });
    const data = await res.json();
    if (data.success) location.reload();
    else alert(data.error);
}

async function batchAddUsers() {
    const text = document.getElementById('emailList').value;
    if (!text.trim()) return alert('ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”.');
    
    const res = await fetch('/admin/users/batch_add', { 
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ emails: text })
    });
    const data = await res.json();
    if (data.success) {
        alert(`${data.added}ëª… ë“±ë¡ ì™„ë£Œ (ì¤‘ë³µ ${data.duplicates}ëª…)`);
        location.reload();
    } else {
        alert(data.error);
    }
}

async function deleteUser(userId) {
    if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ëŒ€í™” ë‚´ìš©ë„ ì‚­ì œë©ë‹ˆë‹¤)')) return;
    const res = await fetch('/api/admin/delete_user', { 
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ user_id: userId })
    });
    const data = await res.json();
    if (data.success) location.reload();
    else alert(data.error);
}
</script>

<style>
.admin-container { padding: 20px; max-width: 1000px; margin: 0 auto; }
.card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
.admin-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
.admin-table th, .admin-table td { padding: 10px; border-bottom: 1px solid #eee; text-align: left; }
.badge { padding: 3px 8px; border-radius: 10px; font-size: 0.8em; color: white; }
.badge.success { background: #2ecc71; }
.badge.warning { background: #f39c12; }
.btn-small { padding: 5px 10px; border: none; border-radius: 5px; cursor: pointer; background: #3498db; color: white; }
.btn-small.danger { background: #e74c3c; }
.btn-primary { padding: 10px 20px; background: #3498db; color: white; border: none; border-radius: 5px; cursor: pointer; }
</style>
{% endblock %}
